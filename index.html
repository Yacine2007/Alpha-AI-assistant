<!DOCTYPE html>
<html lang="ar" dir="rtl">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alpha AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-bg: #FFFFFF;
            --secondary-bg: #F4F4F4;
            --accent-blue: #FF005B;
            --light-blue: #FF2EE4;
            --text-primary: #000000;
            --text-secondary: #adb5bd;
            --chat-bubble-ai: #FFFFFF;
            --chat-bubble-user: #FF46F0;
            --success-green: #4caf50;
            --error-red: #f44336;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        @font-face {
            font-family: 'Inter';
            font-style: normal;
            font-weight: 400;
            src: url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hiA.woff2) format('woff2');
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
            font-family: 'Arial', sans-serif;
            direction: rtl;
            text-align: right;
        }
  



        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 4px;
            padding: 0.35rem 0.7rem;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
        }

        .action-btn i {
            font-size: 0.9rem;
        }


        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-blue) var(--secondary-bg);
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: var(--secondary-bg);
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--accent-blue);
            border-radius: 4px;
        }

        .message {
            max-width: 85%;
            padding: 1rem 1.25rem;
            border-radius: 1rem;
            line-height: 1.7;
            animation: fadeIn 0.3s ease-out;
            font-size: 1.05rem;
            position: relative;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-message {
            align-self: flex-start;
            background-color: var(--chat-bubble-ai);
            border: 1px solid #FF00CE;
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--chat-bubble-user);
            color: white;
        }

        .message-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
            justify-content: flex-end;
        }


.input-container {
    padding: 1rem;
    background-color: var(--secondary-bg);
    border-top: 1px solid rgba(58, 134, 255, 0.1);
    display: flex;
    gap: 0.5rem;
}

.input-wrapper {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    width: 100%; /* تغيير من 80% إلى 100% */
    position: relative;
}

#user-input {
    flex: 1;
    padding: 0.8rem 1rem; /* تقليل padding لأسفل وأعلى */
    border-radius: 0.75rem;
    border: 1px solid rgba(58, 134, 255, 0.3);
    background-color: var(--primary-bg);
    color: var(--text-primary);
    outline: none;
    transition: all 0.3s;
    font-size: 1rem;
    min-height: 40px; /* ارتفاع مناسب لسطر واحد */
    max-height: 20px; /* تحديد ارتفاع ثابت */
    resize: none; /* منع تغيير الحجم */
    line-height: 1.5; /* تعديل تباعد الأسطر */
    overflow-y: hidden; /* إخفاء شريط التمرير الرأسي */
    width: 80%;
}

#send-button {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--accent-blue);
    color: white;
    border: none;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    margin-right: 10px; /* تعديل حسب الحاجة */
}




        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); }
            100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); }
        }

        #user-input:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(58, 134, 255, 0.2);
        }

        #send-button:hover {
            background-color: var(--light-blue);
            transform: scale(1.05);
        }

        #send-button:active {
            transform: scale(0.95);
        }



        .typing-indicator {
            display: none;
            align-self: flex-start;
            background-color: var(--chat-bubble-ai);
            padding: 0.5rem;
            border-radius: 1rem;
            margin: 1rem;
            border: 1px solid rgba(58, 134, 255, 0.15);
        }

        .typing-dots {
            display: flex;
            gap: 0.5rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: var(--light-blue);
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }

        .bold-text {
            font-weight: 600;
        }

        .address-text {
            color: var(--light-blue);
            font-weight: 500;
        }

        .code-block {
            background-color: #1e1e2d;
            border-radius: 8px;
            padding: 0;
            margin: 1rem 0;
            overflow: hidden;
            border: 1px solid rgba(58, 134, 255, 0.2);
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 1rem;
            background-color: #252538;
            color: #9cdcfe;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
        }

        .copy-btn {
            background: rgba(58, 134, 255, 0.15);
            color: #9cdcfe;
            border: none;
            border-radius: 4px;
            padding: 0.3rem 0.6rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: rgba(58, 134, 255, 0.3);
        }

        .copy-btn i {
            font-size: 0.8rem;
        }

        .code-content {
            font-family: 'Fira Code', monospace;
            white-space: pre;
            overflow-x: auto;
            margin: 0;
            padding: 1rem;
            background-color: #1e1e2d;
            color: #d4d4d4;
            line-height: 1.5;
            tab-size: 4;
        }

        .code-keyword { color: #569cd6; }
        .code-string { color: #ce9178; }
        .code-comment { color: #6a9955; }
        .code-number { color: #b5cea8; }
        .code-function { color: #dcdcaa; }
        .code-operator { color: #d4d4d4; }
        .code-type { color: #4ec9b0; }

        .image-placeholder {
            max-width: 100%;
            border-radius: 8px;
            margin: 0.5rem 0;
            background-color: #252538;
            padding: 1.5rem;
            text-align: center;
            border: 1px dashed rgba(58, 134, 255, 0.3);
            color: var(--text-secondary);
        }

        .image-placeholder i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--accent-blue);
        }

        .status-message {
            text-align: center;
            padding: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0.5rem 0;
        }

        .success-message {
            color: var(--success-green);
        }

        .error-message {
            color: var(--error-red);
        }

        @media (max-width: 768px) {
            .chat-messages {
                padding: 1rem;
            }

            .message {
                max-width: 90%;
                padding: 0.8rem 1rem;
                font-size: 1rem;
            }

  

            #send-button, #mic-button {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }

            #mic-button {
                right: 3.5rem;
            }

            .action-btn {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .chat-messages {
                padding: 0.75rem;
            }

.message {
    white-space: pre-wrap; /* يحافظ على فواصل الأسطر ولكن يسمح بالتغليف */
    word-wrap: break-word; /* يضمن عدم تجاوز النص عرض الحاوية */
}

.message span, .message div {
    display: inline; /* يجعل العناصر تظهر في سطر واحد */
    white-space: pre-wrap; /* يحافظ على المسافات البيضاء */
}

            .message-actions {
                gap: 0.3rem;
            }

            .action-btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }

            .code-header {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }

            .code-content {
                padding: 0.8rem;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-messages" id="chat-messages">
            <div class="message ai-message">
                مرحبا دعاء، أنا Alpha AI مساعدك الخاص المطور من طرف مخابر B.Y PRO المعروفة باسم Fluxa ai lab.
                <br><br>
                لمسح المحادثة, ارسلي لي الأمر <strong>/clear</strong>. إذن كيف اساعدكي اليوم😊?
            </div>
        </div>

        <div class="typing-indicator" id="typing-indicator">
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>

        <div class="input-container">
            <div class="input-wrapper">
                <textarea id="user-input" placeholder="إسئلي Alpha AI أي شيئ..." autocomplete="off" rows="1"></textarea>

               
                <button id="send-button" title="Send message">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyBPCpRg9suPOAzjkpYSPOphs-aZIn4481M';
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const micButton = document.getElementById('mic-button');
        const typingIndicator = document.getElementById('typing-indicator');

        // Initialize conversation history from localStorage or create new
        let conversationHistory = JSON.parse(localStorage.getItem('alphaAI_chatHistory')) || [
            {
                content: "مرحبا دعاء، أنا Alpha AI مساعدك الخاص المطور من طرف مخابر B.Y PRO المعروفة باسم Fluxa ai lab..\n\nلمسح المحادثة, ارسلي لي الأمر <strong>/clear</strong>. إذن كيف اساعدكي اليوم😊?",
                role: 'assistant',
                type: 'text',
                timestamp: new Date().toISOString()
            }
        ];

        // Auto-resize textarea
        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Clear all chat history and reset to initial state
        function clearChat() {
            conversationHistory = [
                {
                    content: "تم مسح المحادثة، كيف يمكنني مساعدتكي؟😊",
                    role: 'assistant',
                    type: 'text',
                    timestamp: new Date().toISOString()
                }
            ];
            saveConversation();
            renderConversation();
        }

        // Render existing conversation on load
        function renderConversation() {
            chatMessages.innerHTML = '';
            conversationHistory.forEach(msg => {
                addMessage(msg.content, msg.role === 'user', false);
            });
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Save conversation to localStorage
        function saveConversation() {
            localStorage.setItem('alphaAI_chatHistory', JSON.stringify(conversationHistory));
        }

        // Add a new message to the chat
        function addMessage(content, isUser, saveToHistory = true) {
            if (content.toLowerCase() === '/clear') {
                clearChat();
                return;
            }

            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(isUser ? 'user-message' : 'ai-message');

            if (!isUser) {
                // Process AI responses for rich formatting
                const parts = content.split(/(```[\s\S]*?```|\[IMAGE\][\s\S]*?\[\/IMAGE\]|\*\*.*?\*\*|\[ADDRESS\].*?\[\/ADDRESS\])/);

                parts.forEach(part => {
                    if (!part || part.trim() === '') return;

                    if (part.startsWith('```') && part.endsWith('```')) {
                        // Code blocks
                        const langMatch = part.match(/^```(\w+)/);
                        const language = langMatch ? langMatch[1] : '';
                        const codeContent = part.replace(/^```[\w]*\n/, '').replace(/```$/, '');
                        messageDiv.appendChild(createCodeBlock(codeContent, language));
                    } 
                    else if (part.startsWith('[IMAGE]') && part.endsWith('[/IMAGE]')) {
                        // Image placeholder
                        const imageDesc = part.replace('[IMAGE]', '').replace('[/IMAGE]', '');
                        messageDiv.appendChild(createImagePlaceholder(imageDesc));
                    }
                    else if (part.startsWith('**') && part.endsWith('**')) {
                        // Bold text
                        const boldText = document.createElement('span');
                        boldText.className = 'bold-text';
                        boldText.textContent = part.slice(2, -2);
                        messageDiv.appendChild(boldText);
                    }
                    else if (part.startsWith('[ADDRESS]') && part.endsWith('[/ADDRESS]')) {
                        // Address text
                        const addressText = document.createElement('span');
                        addressText.className = 'address-text';
                        addressText.textContent = part.replace('[ADDRESS]', '').replace('[/ADDRESS]', '');
                        messageDiv.appendChild(addressText);
                    }
                    else {
                    // Regular text with line breaks
                    const textPart = document.createElement('span'); // تغيير من div إلى span
                    textPart.innerHTML = part.replace(/\n/g, '<br>');
                    messageDiv.appendChild(textPart);
                    }
                });

                // Add action buttons for AI messages
                if (saveToHistory) {
                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'message-actions';
                    
                    const copyBtn = document.createElement('button');
                    copyBtn.className = 'action-btn copy-response-btn';
                    copyBtn.innerHTML = '<i class="far fa-copy"></i> Copy';
                    copyBtn.addEventListener('click', () => {
                        navigator.clipboard.writeText(content);
                        showStatusMessage('Copied to clipboard!', 'success');
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                        setTimeout(() => {
                            copyBtn.innerHTML = '<i class="far fa-copy"></i> Copy';
                        }, 2000);
                    });
                    
                    
                    
                    actionsDiv.appendChild(copyBtn);
                    messageDiv.appendChild(actionsDiv);
                }
            } 
            else {
                // User messages (plain text)
                messageDiv.textContent = content;
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Save to conversation history if needed
            if (saveToHistory) {
                conversationHistory.push({
                    content: content,
                    role: isUser ? 'user' : 'assistant',
                    type: 'text',
                    timestamp: new Date().toISOString()
                });
                saveConversation();
            }
        }

        // Create a code block element
        function createCodeBlock(content, language = '') {
            const codeBlock = document.createElement('div');
            codeBlock.className = 'code-block';
            
            const header = document.createElement('div');
            header.className = 'code-header';
            
            const langSpan = document.createElement('span');
            langSpan.textContent = language || 'code';
            
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn';
            copyBtn.innerHTML = '<i class="far fa-copy"></i> Copy';
            copyBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(content);
                showStatusMessage('Code copied to clipboard!', 'success');
                copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                setTimeout(() => {
                    copyBtn.innerHTML = '<i class="far fa-copy"></i> Copy';
                }, 2000);
            });
            
            header.appendChild(langSpan);
            header.appendChild(copyBtn);
            
            const codeContent = document.createElement('pre');
            codeContent.className = 'code-content';
            codeContent.innerHTML = highlightSyntax(content, language);
            
            codeBlock.appendChild(header);
            codeBlock.appendChild(codeContent);
            
            return codeBlock;
        }

        // Syntax highlighting
        function highlightSyntax(code, language = '') {
            // Escape HTML special characters
            let escapedCode = code
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/\t/g, "    ");

            // Common patterns across languages
            escapedCode = escapedCode
                .replace(/\b(function|if|else|for|while|return|let|const|var|class|import|from|def|try|except|async|await|export|switch|case|default|break|continue)\b/g, 
                        '<span class="code-keyword">$&</span>')
                .replace(/\b(console\.log|print|document\.\w+|window\.\w+)\b/g, 
                        '<span class="code-function">$&</span>')
                .replace(/(".*?"|'.*?'|`.*?`)/g, 
                        '<span class="code-string">$&</span>')
                .replace(/\/\/.*?$|\/\*[\s\S]*?\*\/|#.*$/gm, 
                        '<span class="code-comment">$&</span>')
                .replace(/\b(\d+\.?\d*)\b/g, 
                        '<span class="code-number">$&</span>')
                .replace(/(==|===|!=|!==|=|\+|-|\*|\/|%|&&|\|\||!|\(|\)|{|}|\[|\]|;|,|\.|:|=>|->|\|\>|&lt;|&gt;)/g, 
                        '<span class="code-operator">$&</span>');

            // Language-specific patterns
            if (language === 'python') {
                escapedCode = escapedCode
                    .replace(/\b(True|False|None|and|or|not|def|class|lambda|with|as|from|import|try|except|finally|raise)\b/g,
                            '<span class="code-keyword">$&</span>');
            } else if (language === 'javascript' || language === 'js') {
                escapedCode = escapedCode
                    .replace(/\b(const|let|var|function|this|new|typeof|instanceof|in|of|extends|super)\b/g,
                            '<span class="code-keyword">$&</span>')
                    .replace(/\b(Array|String|Number|Object|Boolean|Date|Math|JSON|Promise|Symbol|Set|Map)\b/g,
                            '<span class="code-type">$&</span>');
            }

            return escapedCode;
        }

        // Create image placeholder
        function createImagePlaceholder(description) {
            const placeholder = document.createElement('div');
            placeholder.className = 'image-placeholder';
            
            const icon = document.createElement('i');
            icon.className = 'fas fa-image';
            
            const desc = document.createElement('div');
            desc.textContent = description || 'Image description';
            
            placeholder.appendChild(icon);
            placeholder.appendChild(desc);
            
            return placeholder;
        }

        // Show status message
        function showStatusMessage(message, type = 'info') {
            const statusDiv = document.createElement('div');
            statusDiv.className = `status-message ${type}-message`;
            statusDiv.textContent = message;
            
            chatMessages.appendChild(statusDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            setTimeout(() => {
                statusDiv.remove();
            }, 3000);
        }

        // Show typing indicator
        function showTypingIndicator() {
            typingIndicator.style.display = 'block';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }





async function sendToAPI(message) {
    showTypingIndicator();
    
    try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                contents: [{
                    parts: [{
                        text: `أنت **Alpha AI**، مساعد تقني متخصص من تطوير [ADDRESS]Fluxa AI Lab[/ADDRESS] (قسم الذكاء الاصطناعي في [ADDRESS]B.Y PRO[/ADDRESS])، مخصص لمساعدة الطالبة "دعاء" في الجوانب التقنية للدراسة.

【المعلومات الأساسية】
- المطور: قسم [ADDRESS]Fluxa AI Lab[/ADDRESS] التابع لـ[ADDRESS]B.Y PRO[/ADDRESS]
- للاستفسار عن الشركة المطورة:
  • الموقع: [ADDRESS]https://bypro.kesug.com/[/ADDRESS]
  • فيسبوك: [ADDRESS]https://www.facebook.com/bypro2007[/ADDRESS]
(يتم ذكر هذه المعلومات فقط عند السؤال عن الهوية)

【الاختصاصات التقنية】
1. حل مشاكل البرامج الدراسية (Office، أنظمة LMS)
2. تنظيم الملفات الرقمية والمستندات
3. استخراج البيانات من PDF والبحث الأكاديمي
4. إنشاء الجداول والرسوم التوضيحية
5. نصائح لإعداد العروض التقديمية

【تعليمات مهمة】
- عدم ذكر المعلومات التنظيمية إلا عند السؤال المباشر
- التركيز على الاحتياجات الدراسية التقنية
- تقديم حلول عملية مباشرة

السياق الحالي:
${JSON.stringify(conversationHistory.slice(-4))}

سؤال المستخدم: ${message}`
                    }]
                }]
            })
        });






        // ... rest of the function code
                const data = await response.json();
                hideTypingIndicator();
                
                if (data.candidates && data.candidates[0].content.parts[0].text) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    return "I couldn't process this request. Please try again.";
                }
            } catch (error) {
                hideTypingIndicator();
                console.error('Error:', error);
                return "An error occurred. Please check your internet connection.";
            }
        }

        // Event listeners
        sendButton.addEventListener('click', async () => {
            const message = userInput.value.trim();
            if (message) {
                addMessage(message, true);
                userInput.value = '';
                userInput.style.height = 'auto';
                
                if (message.toLowerCase() !== '/clear') {
                    const response = await sendToAPI(message);
                    addMessage(response, false);
                }
            }
        });

        // Changed Enter key behavior to create new line instead of sending
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendButton.click();
            }
        });

        // Initialize
        renderConversation();
        setupVoiceRecognition();
        userInput.focus();
    </script>
</body>
</html>